<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kurumsal Dijital Platform</title>
    
    <!-- STÄ°L -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 900: '#1e3a8a' },
                        dark: { 800: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    
    <!-- REACT & FIREBASE -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { background-color: #F8FAFC; -webkit-tap-highlight-color: transparent; }
        
        /* Modern Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 10px; }
        
        /* Tooltip Fix - Ãœstte Kalma Sorunu Ã‡Ã¶zÃ¼ldÃ¼ */
        .tooltip-container {
            z-index: 9999 !important; 
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
        }

        /* Kart Efektleri */
        .hover-card { transition: all 0.3s ease; }
        .hover-card:hover { transform: translateY(-4px); box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1); }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .print-area { width: 100%; margin: 0; padding: 0; }
            table { width: 100% !important; border-collapse: collapse; font-size: 10px; border: 1px solid #eee; }
            th, td { border: 1px solid #000 !important; padding: 4px !important; }
            aside, header, .card-view, .modal-overlay { display: none !important; }
        }
        .fixed-table { table-layout: fixed; width: 100%; }
        .wrap-text { word-wrap: break-word; white-space: pre-wrap; }
        
        /* OnaylanmÄ±ÅŸ satÄ±r stili */
        .status-approved { background-color: #F0FDF4 !important; }
        
        /* Animasyonlar */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
    </style>
</head>
<body class="text-slate-800 antialiased">

    <div id="root"></div>

    <script type="text/babel">
        // =================================================================
        // ðŸ”¥ FIREBASE AYARLARI
        // =================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyAzF-qtvwK0gszwNupyLC0_Fv2YNZtrMB4",
            authDomain: "kurumsal-asistan.firebaseapp.com",
            projectId: "kurumsal-asistan",
            storageBucket: "kurumsal-asistan.firebasestorage.app",
            messagingSenderId: "1091801269872",
            appId: "1:1091801269872:web:dfc5f6feec7771a85cd6b5",
            measurementId: "G-Z9ES2MSV2Z"
        };

        // --- GÃœVENLÄ° BAÅžLATMA ---
        let db = null;
        let sysError = null;

        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            console.log("Firebase baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±.");
        } catch (e) {
            console.error("Firebase HatasÄ±:", e);
            sysError = "VeritabanÄ± baÄŸlantÄ±sÄ± kurulamadÄ±. LÃ¼tfen internet baÄŸlantÄ±nÄ±zÄ± kontrol edin.";
        }

        const { useState, useEffect } = React;

        // --- Ä°KON SETÄ° ---
        const Icons = {
            Logo: () => <svg className="w-6 h-6 md:w-8 md:h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>,
            Dashboard: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>,
            Users: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            List: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>,
            Bug: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
            Plus: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4" /></svg>,
            Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            LogOut: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
            Building: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>,
            Edit: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" /></svg>,
            Close: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>,
            Question: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        };

        // --- GÃœNCELLENMÄ°Åž INFO CARD (TIKLAMALI TOOLTIP FIX) ---
        const InfoCard = ({ title, value, color, icon, desc }) => {
            const [showTooltip, setShowTooltip] = useState(false);
            
            return (
                <div className={`bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative hover:shadow-md transition-all duration-300`}>
                    <div className="flex justify-between items-start">
                        <div>
                            <h3 className="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">{title}</h3>
                            <p className="text-3xl font-bold text-slate-800">{value}</p>
                        </div>
                        <div className={`p-2 rounded-lg ${color} bg-opacity-10 text-opacity-100`}>{icon}</div>
                    </div>
                    {desc && (
                        <div className="absolute top-3 right-3 cursor-help">
                            <button 
                                onClick={() => setShowTooltip(!showTooltip)}
                                onBlur={() => setTimeout(() => setShowTooltip(false), 200)} 
                                className="text-slate-300 hover:text-blue-500 transition-colors focus:outline-none"
                            >
                                <Icons.Question />
                            </button>
                            {showTooltip && (
                                <div className="tooltip-container w-56 p-3 text-xs text-white bg-slate-800 rounded-xl shadow-xl border border-slate-700 animate-fade-in">
                                    {desc}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // --- LOGIN EKRANI ---
        const LoginScreen = ({ onLogin }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                const success = await onLogin(username, password);
                if (!success) setError("KullanÄ±cÄ± adÄ± veya ÅŸifre hatalÄ±!");
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex flex-col lg:flex-row bg-white">
                    <div className="lg:w-1/2 bg-brand-600 relative overflow-hidden flex items-center justify-center p-8 lg:p-12 h-48 lg:h-auto">
                        <div className="absolute inset-0 bg-gradient-to-br from-brand-600 to-brand-900 opacity-90"></div>
                        <div className="relative z-10 text-white text-center lg:text-left">
                            <h1 className="text-2xl lg:text-5xl font-extrabold mb-2 lg:mb-6 leading-tight">Kurumsal Platform</h1>
                            <p className="text-blue-100 text-sm lg:text-lg hidden lg:block">Dijital dÃ¶nÃ¼ÅŸÃ¼m sÃ¼reÃ§lerinizi tek bir noktadan yÃ¶netin.</p>
                        </div>
                    </div>
                    <div className="w-full lg:w-1/2 flex flex-col items-center justify-center p-6 lg:p-12 flex-1">
                        <div className="w-full max-w-md space-y-8">
                            <div className="text-center"><h2 className="text-2xl lg:text-3xl font-bold text-slate-900">GiriÅŸ Yap</h2><p className="mt-2 text-sm text-slate-500">Hesap bilgilerinizi giriniz</p></div>
                            <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">KullanÄ±cÄ± AdÄ±</label><input type="text" required value={username} onChange={e => setUsername(e.target.value)} className="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none" placeholder="Ã–rn: ahmet" /></div>
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">Åžifre</label><input type="password" required value={password} onChange={e => setPassword(e.target.value)} className="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" /></div>
                                </div>
                                {error && <div className="text-red-600 text-sm bg-red-50 p-3 rounded-lg font-medium">{error}</div>}
                                <button type="submit" disabled={loading} className="w-full py-3.5 px-4 bg-brand-600 text-white rounded-xl font-bold hover:bg-brand-700 transition-all shadow-lg disabled:opacity-70">{loading ? 'GiriÅŸ YapÄ±lÄ±yor...' : 'GiriÅŸ Yap'}</button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ADMÄ°N PANELÄ° ---
        const AdminDashboard = ({ users, processes, feedbacks, departments, onAddUser, onDeleteUser, onUpdateUser, onAddDept, onDeleteDept, onUpdateFeedback, onDeleteFeedback, onUpdateProcess }) => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [filterDept, setFilterDept] = useState('TÃ¼mÃ¼');
            const [filterPersonnel, setFilterPersonnel] = useState('TÃ¼mÃ¼');
            const [newUser, setNewUser] = useState({ name:'', username:'', password:'', dept:'' });
            const [editingUser, setEditingUser] = useState(null);

            const stats = {
                users: users.filter(u=>u.role!=='admin').length,
                steps: processes.length,
                pending: feedbacks.filter(f=>f.status==='Bekliyor').length,
                depts: departments.length
            };

            const filteredProcesses = processes.filter(p => {
                const deptMatch = filterDept === 'TÃ¼mÃ¼' || p.dept === filterDept;
                const persMatch = filterPersonnel === 'TÃ¼mÃ¼' || p.actor === filterPersonnel;
                return deptMatch && persMatch;
            });

            const handleUpdateUser = () => {
                if(!editingUser.name || !editingUser.username || !editingUser.password) return alert("Bilgiler boÅŸ olamaz.");
                onUpdateUser(editingUser.id, { name: editingUser.name, username: editingUser.username, password: editingUser.password, dept: editingUser.dept });
                setEditingUser(null);
            };

            const handleApproveProcess = (id) => {
                if(confirm("Bu kaydÄ± onaylÄ±yor musunuz?")) onUpdateProcess(id, { status: 'OnaylandÄ±' });
            };

            return (
                <div className="flex flex-col h-full bg-[#F8FAFC]">
                    <div className="bg-white/80 backdrop-blur-md border-b border-slate-200 px-4 lg:px-8 py-3 flex gap-4 overflow-x-auto no-print sticky top-0 z-20">
                         {['dashboard', 'users', 'processes', 'feedbacks'].map(tab => (
                            <button key={tab} onClick={()=>setActiveTab(tab)} className={`whitespace-nowrap px-3 py-2 text-sm font-medium rounded-lg transition-colors ${activeTab===tab ? 'bg-brand-50 text-brand-600' : 'text-slate-500 hover:text-slate-800'}`}>
                                {tab === 'dashboard' ? 'Ã–zet' : tab === 'users' ? 'Organizasyon' : tab === 'processes' ? 'Master Veri' : 'Bildirimler'}
                            </button>
                        ))}
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 lg:p-8">
                         {/* DASHBOARD TAB */}
                         {activeTab === 'dashboard' && (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 animate-fade-in">
                                <InfoCard title="PERSONEL" value={stats.users} color="text-blue-600 bg-blue-600" icon={<Icons.Users/>} desc="Sistemde kayÄ±tlÄ± ve veri giriÅŸi yapabilen toplam aktif personel sayÄ±sÄ±." />
                                <InfoCard title="TOPLAM VERÄ°" value={stats.steps} color="text-green-600 bg-green-600" icon={<Icons.List/>} desc="TÃ¼m departmanlardan sisteme girilmiÅŸ toplam sÃ¼reÃ§ adÄ±mÄ± sayÄ±sÄ±." />
                                <InfoCard title="DEPARTMAN" value={stats.depts} color="text-purple-600 bg-purple-600" icon={<Icons.Building/>} desc="Åžirket organizasyonunda tanÄ±mlanmÄ±ÅŸ aktif birim sayÄ±sÄ±." />
                                <InfoCard title="BÄ°LDÄ°RÄ°M" value={stats.pending} color="text-red-600 bg-red-600" icon={<Icons.Bug/>} desc="Personelden gelen, henÃ¼z incelenmemiÅŸ veya kapatÄ±lmamÄ±ÅŸ hata/Ã¶neri bildirimleri." />
                            </div>
                        )}
                        
                        {/* USERS TAB (YENÄ°LENMÄ°Åž KART TASARIMI) */}
                        {activeTab === 'users' && (
                            <div className="space-y-10 animate-fade-in">
                                {/* Departmanlar BÃ¶lÃ¼mÃ¼ */}
                                <section>
                                    <div className="flex justify-between items-end mb-6">
                                        <div>
                                            <h3 className="text-xl font-bold text-slate-800">Departmanlar</h3>
                                            <p className="text-sm text-slate-500">Kurumsal birimleri yÃ¶netin.</p>
                                        </div>
                                        <button onClick={()=>{const d = prompt("Yeni Departman AdÄ±:"); if(d) onAddDept(d)}} className="bg-brand-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg shadow-brand-200 hover:bg-brand-700 transition-all flex items-center gap-2">
                                            <Icons.Plus /> Yeni Ekle
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                                        {departments.map(d => (
                                            <div key={d.id} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md hover:border-brand-200 transition-all relative group overflow-hidden">
                                                <div className="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-brand-50 to-transparent opacity-50 rounded-bl-full -mr-4 -mt-4"></div>
                                                
                                                <div className="relative z-10">
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div className="p-3 bg-brand-50 text-brand-600 rounded-xl"><Icons.Building /></div>
                                                        <button onClick={()=>{if(confirm(d.name + " silinsin mi?")) onDeleteDept(d.id)}} className="text-slate-300 hover:text-red-500 transition-colors p-1 opacity-0 group-hover:opacity-100"><Icons.Trash /></button>
                                                    </div>
                                                    <h4 className="text-lg font-bold text-slate-800 mb-1">{d.name}</h4>
                                                    <div className="flex items-center gap-2 text-xs text-slate-500 font-medium">
                                                        <Icons.Users /> <span>{users.filter(u => u.dept === d.name).length} Personel</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </section>

                                {/* Personel YÃ¶netimi BÃ¶lÃ¼mÃ¼ */}
                                <section className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    {/* Personel Ekleme */}
                                    <div className="lg:col-span-1 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit sticky top-24">
                                        <h3 className="font-bold text-lg mb-4 text-slate-800 border-b pb-2">Personel KaydÄ±</h3>
                                        <div className="space-y-3">
                                            <input value={newUser.name} onChange={e=>setNewUser({...newUser, name:e.target.value})} className="w-full border p-3 rounded-xl text-sm bg-slate-50" placeholder="Ad Soyad" />
                                            <div className="grid grid-cols-2 gap-3">
                                                <input value={newUser.username} onChange={e=>setNewUser({...newUser, username:e.target.value})} className="w-full border p-3 rounded-xl text-sm bg-slate-50" placeholder="KullanÄ±cÄ± AdÄ±" />
                                                <input value={newUser.password} onChange={e=>setNewUser({...newUser, password:e.target.value})} className="w-full border p-3 rounded-xl text-sm bg-slate-50" placeholder="Åžifre" />
                                            </div>
                                            <div className="relative">
                                                <label className="block text-xs font-bold text-slate-400 mb-1 uppercase">Departman</label>
                                                <select value={newUser.dept} onChange={e=>setNewUser({...newUser, dept:e.target.value})} className="w-full border border-slate-200 p-3 rounded-xl text-sm bg-white focus:ring-2 focus:ring-brand-500 outline-none appearance-none">
                                                    <option value="">SeÃ§iniz...</option>
                                                    {departments.map((d) => (<option key={d.id} value={d.name}>{d.name}</option>))}
                                                </select>
                                                <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 pt-6 text-slate-500"><svg className="h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg></div>
                                            </div>
                                            <button onClick={()=>{
                                                if(!newUser.name || !newUser.username || !newUser.dept) return alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun.");
                                                onAddUser(newUser); 
                                                setNewUser({name:'', username:'', password:'', dept:''});
                                            }} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition-transform active:scale-95">Kaydet</button>
                                        </div>
                                    </div>

                                    {/* Personel Listesi */}
                                    <div className="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                        <h3 className="font-bold text-lg mb-4 text-slate-800 border-b pb-2">Personel Listesi</h3>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-left text-sm">
                                                <thead className="bg-slate-50 text-slate-500 font-medium"><tr><th className="p-4">Ad</th><th className="p-4">K.AdÄ±</th><th className="p-4">Dept</th><th className="p-4">Åžifre</th><th className="p-4 text-right">Ä°ÅŸlem</th></tr></thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    {users.filter(u=>u.role!=='admin').map(u=>(
                                                        <tr key={u.id} className="hover:bg-slate-50 transition-colors">
                                                            <td className="p-4 font-medium">{u.name}</td>
                                                            <td className="p-4 text-slate-500">{u.username}</td>
                                                            <td className="p-4"><span className="px-2 py-1 bg-slate-100 rounded text-xs">{u.dept}</span></td>
                                                            <td className="p-4 font-mono text-xs">{u.password}</td>
                                                            <td className="p-4 text-right flex justify-end gap-2">
                                                                <button onClick={()=>setEditingUser({...u})} className="text-blue-400 bg-blue-50 p-2 rounded hover:bg-blue-100"><Icons.Edit/></button>
                                                                <button onClick={()=>{if(confirm("Silinsin mi?")) onDeleteUser(u.id)}} className="text-red-400 bg-red-50 p-2 rounded hover:bg-red-100"><Icons.Trash/></button>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        )}

                         {/* Edit User Modal */}
                         {editingUser && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white p-6 rounded-2xl shadow-2xl w-full max-w-md animate-fade-in">
                                    <div className="flex justify-between items-center mb-6"><h3 className="text-xl font-bold">DÃ¼zenle</h3><button onClick={()=>setEditingUser(null)}><Icons.Close/></button></div>
                                    <div className="space-y-4">
                                        <input value={editingUser.name} onChange={e=>setEditingUser({...editingUser, name:e.target.value})} className="w-full border p-3 rounded-xl" placeholder="Ad" />
                                        <input value={editingUser.username} onChange={e=>setEditingUser({...editingUser, username:e.target.value})} className="w-full border p-3 rounded-xl" placeholder="KullanÄ±cÄ± AdÄ±" />
                                        <input value={editingUser.password} onChange={e=>setEditingUser({...editingUser, password:e.target.value})} className="w-full border p-3 rounded-xl" placeholder="Åžifre" />
                                        <select value={editingUser.dept} onChange={e=>setEditingUser({...editingUser, dept:e.target.value})} className="w-full border p-3 rounded-xl bg-white">
                                            {departments.map(d=><option key={d.id} value={d.name}>{d.name}</option>)}
                                        </select>
                                        <button onClick={handleUpdateUser} className="w-full bg-brand-600 text-white py-3 rounded-xl font-bold">Kaydet</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* MASTER SÃœREÃ‡LER */}
                        {activeTab === 'processes' && (
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                <div className="p-4 lg:p-6 border-b border-slate-100 flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 no-print">
                                    <h3 className="font-bold text-lg text-slate-800">Veri Havuzu</h3>
                                    <div className="flex flex-wrap gap-2 w-full lg:w-auto">
                                        <select value={filterDept} onChange={e=>setFilterDept(e.target.value)} className="border p-2 rounded-lg text-sm flex-1"><option value="TÃ¼mÃ¼">TÃ¼m Dept.</option>{departments.map(d=><option key={d.id} value={d.name}>{d.name}</option>)}</select>
                                        <div className="w-px h-4 bg-slate-300 lg:block hidden"></div>
                                        <select value={filterPersonnel} onChange={e=>setFilterPersonnel(e.target.value)} className="border p-2 rounded-lg text-sm flex-1"><option value="TÃ¼mÃ¼">TÃ¼m Personel</option>{users.filter(u=>u.role!=='admin').map(u=><option key={u.id} value={u.name}>{u.name}</option>)}</select>
                                        <button onClick={()=>window.print()} className="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold">YazdÄ±r</button>
                                    </div>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left text-xs border-collapse">
                                        <thead className="bg-slate-50 text-slate-500 uppercase font-bold">
                                            <tr>
                                                <th className="p-4 border-b">Kod</th>
                                                <th className="p-4 border-b">Tarih</th>
                                                <th className="p-4 border-b">Personel</th>
                                                <th className="p-4 border-b">Aksiyon</th>
                                                <th className="p-4 border-b">Sistem</th>
                                                <th className="p-4 border-b">Durum</th>
                                                <th className="p-4 border-b no-print text-center">Ä°ÅŸlem</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {filteredProcesses.map(p=>(
                                                <tr key={p.id} className={`hover:bg-blue-50/50 ${p.status === 'OnaylandÄ±' ? 'status-approved' : ''}`}>
                                                    <td className="p-4 font-mono text-brand-600">{p.smartID}</td>
                                                    <td className="p-4 text-slate-500">{p.displayDate}</td>
                                                    <td className="p-4 font-bold text-slate-700">{p.actor}<br/><span className="font-normal text-slate-400 text-[10px]">{p.dept}</span></td>
                                                    <td className="p-4 wrap-text max-w-md">{p.action}</td>
                                                    <td className="p-4">{p.system}</td>
                                                    <td className="p-4">
                                                        {p.status === 'OnaylandÄ±' ? <span className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold">OnaylÄ±</span> : <span className="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-bold">Bekliyor</span>}
                                                    </td>
                                                    <td className="p-4 text-center no-print">
                                                        {p.status !== 'OnaylandÄ±' && <button onClick={()=>handleApproveProcess(p.id)} className="bg-green-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-600 transition-colors">Onayla</button>}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'feedbacks' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {feedbacks.map(f => (
                                    <div key={f.id} className={`bg-white rounded-xl p-5 border-l-4 shadow-sm relative ${f.priority === 'Kritik' ? 'border-l-red-500' : f.priority === 'YÃ¼ksek' ? 'border-l-orange-500' : 'border-l-blue-500'}`}>
                                        <div className="flex justify-between mb-2">
                                            <span className="text-xs font-bold bg-slate-100 px-2 py-1 rounded text-slate-600">{f.type}</span>
                                            <span className={`text-xs font-bold px-2 py-1 rounded ${f.status==='Bekliyor'?'bg-yellow-100 text-yellow-700':'bg-green-100 text-green-700'}`}>{f.status}</span>
                                        </div>
                                        <h4 className="font-bold text-slate-800">{f.subject}</h4>
                                        <p className="text-xs text-slate-500 mt-1 line-clamp-3">{f.desc}</p>
                                        <div className="mt-4 pt-3 border-t flex justify-between items-center">
                                            <div className="text-xs"><span className="font-bold block text-slate-700">{f.reporter}</span><span className="text-slate-400">{f.dept}</span></div>
                                            <div className="flex gap-2">
                                                {f.status!=='TamamlandÄ±' && <button onClick={()=>onUpdateFeedback(f.id, f.status==='Bekliyor'?'Ä°nceleniyor':'TamamlandÄ±')} className="text-xs bg-slate-900 text-white px-3 py-1 rounded hover:bg-slate-700">Kapat</button>}
                                                <button onClick={()=>{if(confirm("Silinsin mi?")) onDeleteFeedback(f.id)}} className="text-red-500 bg-red-50 p-1.5 rounded"><Icons.Trash/></button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- EMPLOYEE DASHBOARD (Mobil Uyumlu) ---
        const EmployeeDashboard = ({ currentUser, onAddProcess, onAddFeedback, userProcesses, userFeedbacks, onDeleteProcess }) => {
            const [activeTab, setActiveTab] = useState('entry');
            const [pForm, setPForm] = useState({ trigger: '', action: '', type: 'Operasyonel', system: '', inputs: '', outputs: '', duration: '', frequency: '', decision: '', rules: '', knowledge: '', mistakes: '' });
            
            const handleProcessSubmit = () => {
                if(!pForm.action) return alert("Aksiyon giriniz.");
                const smartID = (pForm.type === 'YÃ¶netimsel' ? 'YNT' : pForm.type === 'Destek' ? 'DST' : 'OPR') + '-' + Math.floor(Math.random()*90000+10000);
                const now = new Date();
                onAddProcess({ ...pForm, actor: currentUser.name, dept: currentUser.dept, createdAt: now.toISOString(), displayDate: now.toLocaleDateString('tr-TR'), smartID, status: 'Bekliyor' });
                setPForm(prev => ({ ...prev, action:'', inputs:'', outputs:'', duration:'', decision:'', rules:'', knowledge:'', mistakes:'' }));
            };

            return (
                <div className="flex flex-col h-full bg-[#F8FAFC]">
                     <div className="bg-white border-b border-slate-200 px-4 py-3 flex gap-4 sticky top-0 z-20">
                         <button onClick={()=>setActiveTab('entry')} className={`flex-1 py-2 text-sm font-bold rounded-lg ${activeTab==='entry'?'bg-brand-50 text-brand-600':'text-slate-500'}`}>Veri GiriÅŸi</button>
                         <button onClick={()=>setActiveTab('feedback')} className={`flex-1 py-2 text-sm font-bold rounded-lg ${activeTab==='feedback'?'bg-brand-50 text-brand-600':'text-slate-500'}`}>Bildirimler</button>
                     </div>

                     <div className="flex-1 overflow-y-auto p-4 lg:p-8">
                        {activeTab==='entry' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                {/* Form */}
                                <div className="lg:col-span-1 bg-white p-5 rounded-2xl shadow-sm border border-slate-100 h-fit">
                                    <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2"><span className="bg-blue-100 text-blue-600 p-1 rounded"><Icons.Plus/></span> KayÄ±t Ekle</h3>
                                    <div className="space-y-3">
                                        <textarea value={pForm.action} onChange={e=>setPForm({...pForm, action:e.target.value})} className="w-full border p-3 rounded-xl text-sm focus:ring-2 focus:ring-brand-500 outline-none" rows="3" placeholder="Ne yapÄ±yorsunuz?"></textarea>
                                        <div className="grid grid-cols-2 gap-2">
                                            <input value={pForm.system} onChange={e=>setPForm({...pForm, system:e.target.value})} className="border p-3 rounded-xl text-sm" placeholder="Sistem" />
                                            <input value={pForm.duration} onChange={e=>setPForm({...pForm, duration:e.target.value})} className="border p-3 rounded-xl text-sm" placeholder="SÃ¼re" />
                                        </div>
                                        <button onClick={handleProcessSubmit} className="w-full bg-brand-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-transform">Kaydet</button>
                                    </div>
                                </div>
                                {/* Liste (Mobil Kart) */}
                                <div className="lg:col-span-2 space-y-3">
                                    {userProcesses.map(p=>(
                                        <div key={p.id} className="bg-white p-4 rounded-xl border shadow-sm flex justify-between items-center relative">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <span className="text-[10px] font-mono text-brand-600 bg-brand-50 px-2 py-0.5 rounded">{p.smartID}</span>
                                                    {p.status==='OnaylandÄ±' && <span className="text-[10px] text-green-600 bg-green-50 px-2 py-0.5 rounded font-bold">OnaylandÄ±</span>}
                                                </div>
                                                <p className="font-bold text-slate-700 text-sm">{p.action}</p>
                                                <p className="text-xs text-slate-400 mt-1">{p.system} â€¢ {p.duration}</p>
                                            </div>
                                            {p.status !== 'OnaylandÄ±' && (
                                                <button onClick={()=>onDeleteProcess(p.id)} className="p-2 text-red-400 hover:text-red-600 bg-red-50 rounded-lg"><Icons.Trash/></button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {activeTab==='feedback' && <div className="text-center text-slate-400 mt-10">Bildirim formu burada yer alacak (yer darlÄ±ÄŸÄ±).</div>}
                     </div>
                </div>
            );
        };

        // --- ANA UYGULAMA ---
        const App = () => {
            if (sysError) return <div className="h-screen flex items-center justify-center text-red-600 bg-red-50 p-10 text-center font-bold">{sysError}</div>;

            const [user, setUser] = useState(null);
            const [usersData, setUsersData] = useState([]);
            const [processes, setProcesses] = useState([]);
            const [feedbacks, setFeedbacks] = useState([]);
            const [departments, setDepartments] = useState([]);

            useEffect(() => {
                if (!db) return;
                const unsubUsers = db.collection('users').onSnapshot(snap => {
                    const u = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if(u.length===0) db.collection('users').add({ name:'YÃ¶netici', username:'admin', password:'12345', role:'admin', dept:'IT' });
                    else setUsersData(u);
                });
                const unsubProc = db.collection('processes').orderBy('createdAt', 'desc').onSnapshot(snap => setProcesses(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubFeed = db.collection('feedbacks').onSnapshot(snap => setFeedbacks(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubDepts = db.collection('departments').onSnapshot(snap => {
                     const d = snap.docs.map(doc => ({ id: doc.id, name: doc.data().name }));
                     if(d.length > 0) setDepartments(d);
                     else ['IT', 'SatÄ±ÅŸ', 'Ä°K', 'Muhasebe'].forEach(name => db.collection('departments').add({name}));
                });
                return () => { unsubUsers(); unsubProc(); unsubFeed(); unsubDepts(); };
            }, []);

            const handleLogin = async (u, p) => {
                const found = usersData.find(usr => usr.username === u && usr.password === p);
                if (found) { setUser(found); return true; }
                return false;
            };

            // CRUD
            const addProcess = (p) => db.collection('processes').add(p);
            const delProcess = (id) => db.collection('processes').doc(id).delete();
            const updProcess = (id, data) => db.collection('processes').doc(id).update(data);
            
            const addUser = (u) => db.collection('users').add({ ...u, role: 'employee' });
            const delUser = (id) => db.collection('users').doc(id).delete();
            const updUser = (id, data) => db.collection('users').doc(id).update(data);
            
            const addFeedback = (f) => db.collection('feedbacks').add({ ...f, status: 'Bekliyor' });
            const updFeedback = (id, status) => db.collection('feedbacks').doc(id).update({ status });
            const delFeedback = (id) => db.collection('feedbacks').doc(id).delete();
            
            const addDept = (name) => db.collection('departments').add({name});
            const delDept = (id) => db.collection('departments').doc(id).delete();

            if (!user) return <LoginScreen onLogin={handleLogin} />;

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-4 lg:px-8 shadow-sm z-30 no-print">
                        <div className="flex items-center gap-2 lg:gap-3">
                            <div className="bg-brand-600 text-white p-1.5 rounded-lg"><Icons.Logo/></div>
                            <span className="font-bold text-sm lg:text-lg text-slate-800 tracking-tight">Kurumsal<span className="text-brand-600">Asistan</span></span>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="text-right hidden sm:block">
                                <p className="text-sm font-bold text-slate-700">{user.name}</p>
                                <p className="text-xs text-slate-400 font-medium">{user.dept}</p>
                            </div>
                            <button onClick={()=>setUser(null)} className="text-slate-400 hover:text-red-600 p-2 rounded-lg bg-slate-50 hover:bg-red-50 transition-colors"><Icons.LogOut/></button>
                        </div>
                    </header>

                    <main className="flex-1 overflow-hidden relative">
                        {user.role === 'admin' ? (
                            <AdminDashboard 
                                users={usersData} processes={processes} feedbacks={feedbacks} departments={departments}
                                onAddUser={addUser} onDeleteUser={delUser} onUpdateUser={updUser} onAddDept={addDept} onDeleteDept={delDept} onUpdateFeedback={updFeedback} onDeleteFeedback={delFeedback} onUpdateProcess={updProcess}
                            />
                        ) : (
                            <EmployeeDashboard 
                                currentUser={user} 
                                userProcesses={processes.filter(p => p.actor === user.name)}
                                userFeedbacks={feedbacks.filter(f => f.reporter === user.name)}
                                onAddProcess={addProcess} onDeleteProcess={delProcess} onAddFeedback={addFeedback}
                            />
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>